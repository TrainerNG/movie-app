<form class="shell" [formGroup]="eventPlannerForm" (ngSubmit)="onSubmit()" novalidate>
  <header class="shell__header">
    <div>
      <p class="eyebrow">Training demo</p>
      <h1>Realtime Event Planner Form</h1>
      <p class="subtitle">
        Demonstrates nested groups, dynamic form arrays, conditional validation, computed summaries and
        live preview for Angular 20 reactive forms.
      </p>
    </div>
    <div class="header__meta">
      <div class="badge" [class.badge--valid]="formStatus() === 'VALID'">Status: {{ formStatus() }}</div>
      <div *ngIf="lastSavedAt()" class="saved-at">Auto-saved at {{ lastSavedAt() }}</div>
      <button type="button" class="btn btn--ghost" (click)="resetForm()">Reset</button>
    </div>
  </header>

  <div class="shell__grid">
    <app-event-info-panel [group]="eventInfoGroup" [categories]="categories()"></app-event-info-panel>

    <app-organizer-info-panel
      [group]="organizerGroup"
      [contactPreference]="contactPreference()"
    ></app-organizer-info-panel>
  </div>

  <div class="panel" formArrayName="tickets">
    <header class="panel__header">
      <div>
        <h2>Ticket tiers</h2>
        <p>Dynamic FormArray with inline validation & derived calculations.</p>
      </div>
      <button type="button" class="btn" (click)="addTicket()">Add tier</button>
    </header>

    <div class="tickets" *ngFor="let ticketGroup of tickets.controls; let i = index; trackBy: trackTicket" [formGroupName]="i">
      <div class="tickets__row">
        <label>
          <span class="label-heading">
            Label <span class="required-indicator" aria-hidden="true">*</span>
          </span>
          <input type="text" formControlName="label" />
        </label>
        <label>
          <span class="label-heading">
            Capacity <span class="required-indicator" aria-hidden="true">*</span>
          </span>
          <input type="number" formControlName="capacity" min="1" />
        </label>
        <label>
          <span class="label-heading">
            Price ($) <span class="required-indicator" aria-hidden="true">*</span>
          </span>
          <input type="number" formControlName="price" min="0" step="1" />
        </label>
        <label>
          <span class="label-heading">
            Available from <span class="required-indicator" aria-hidden="true">*</span>
          </span>
          <input type="date" formControlName="availableFrom" />
        </label>
        <label>
          <span class="label-heading">
            Until <span class="required-indicator" aria-hidden="true">*</span>
          </span>
          <input type="date" formControlName="availableTo" />
        </label>
        <button type="button" class="btn btn--ghost" (click)="removeTicket(i)" [disabled]="tickets.length === 1">
          Remove
        </button>
      </div>
      <small class="error" *ngIf="ticketGroup.hasError('dateOrder')">Until must be after start.</small>
    </div>
  </div>

  <div class="panel panel--summary">
    <h2>Realtime summary</h2>
    <div class="summary">
      <div>
        <p class="eyebrow">Capacity</p>
        <h3>{{ summary().totalCapacity }}</h3>
      </div>
      <div>
        <p class="eyebrow">Potential revenue</p>
        <h3>${{ summary().potentialRevenue | number: '1.0-0' }}</h3>
      </div>
    </div>
    <label class="consent">
      <input type="checkbox" formControlName="agreement" />
      <span>
        I confirm all details are correct.
        <span class="required-indicator" aria-hidden="true">*</span>
      </span>
    </label>
    <small class="error" *ngIf="hasError('agreement', 'required')">Consent is required.</small>
  </div>

  <div class="panel panel--preview">
    <h2>Live payload preview</h2>
    <pre>{{ eventPlannerForm.getRawValue() | json }}</pre>
  </div>

  <div class="panel panel--preview" *ngIf="submittedPayload">
    <h2>Last submitted payload</h2>
    <pre>{{ submittedPayload | json }}</pre>
  </div>

   <div class="actions">
      <button class="btn" type="submit">Submit form</button>
    </div>
  </form>
