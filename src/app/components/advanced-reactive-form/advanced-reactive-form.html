<form class="shell" [formGroup]="eventPlannerForm" (ngSubmit)="onSubmit()" novalidate>
  <header class="shell__header">
    <div>
      <p class="eyebrow">Training demo</p>
      <h1>Realtime Event Planner Form</h1>
      <p class="subtitle">
        Demonstrates nested groups, dynamic form arrays, conditional validation, computed summaries and
        live preview for Angular 20 reactive forms.
      </p>
    </div>
    <div class="header__meta">
      <div class="badge" [class.badge--valid]="formStatus() === 'VALID'">Status: {{ formStatus() }}</div>
      <div *ngIf="lastSavedAt()" class="saved-at">Auto-saved at {{ lastSavedAt() }}</div>
      <button type="button" class="btn btn--ghost" (click)="resetForm()">Reset</button>
    </div>
  </header>

  <div class="shell__grid">
    <div class="panel" formGroupName="eventInfo">
      <h2>Event information</h2>
      <label>
        <span class="label-heading">
          Title <span class="required-indicator" aria-hidden="true">*</span>
        </span>
        <input type="text" formControlName="title" />
      </label>
      <small class="error" *ngIf="hasError('eventInfo.title', 'required')">Title is required.</small>
      <small class="error" *ngIf="hasError('eventInfo.title', 'minlength')">
        Minimum 4 characters are required.
      </small>

      <label>
        <span class="label-heading">
          Description <span class="required-indicator" aria-hidden="true">*</span>
        </span>
        <textarea rows="3" formControlName="description"></textarea>
      </label>
      <small class="error" *ngIf="hasError('eventInfo.description', 'required')">
        Description is required.
      </small>
      <small class="error" *ngIf="hasError('eventInfo.description', 'maxlength')">
        Description cannot exceed 500 characters.
      </small>

      <label>
        <span class="label-heading">
          Category <span class="required-indicator" aria-hidden="true">*</span>
        </span>
        <select formControlName="category">
          <option value="" disabled>Select category</option>
          <option *ngFor="let category of categories()" [value]="category">{{ category }}</option>
        </select>
      </label>
      <small class="error" *ngIf="hasError('eventInfo.category', 'required')">Pick a category.</small>

      <div class="grid-2">
        <label>
          <span class="label-heading">
            Starts on <span class="required-indicator" aria-hidden="true">*</span>
          </span>
          <input type="date" formControlName="startDate" />
        </label>
        <label>
          <span class="label-heading">
            Ends on <span class="required-indicator" aria-hidden="true">*</span>
          </span>
          <input type="date" formControlName="endDate" />
        </label>
      </div>
      <small class="error" *ngIf="hasError('eventInfo', 'dateOrder')">End date must be after start.</small>

      <label class="toggle">
        <input type="checkbox" formControlName="isVirtual" />
        Host virtually
      </label>

      <label *ngIf="eventPlannerForm.get('eventInfo.isVirtual')?.value">
        <span class="label-heading">
          Meeting URL <span class="required-indicator" aria-hidden="true">*</span>
        </span>
        <small class="required-note">Required when hosting virtually.</small>
        <input type="url" formControlName="meetingUrl" placeholder="https://" />
      </label>
      <small class="error" *ngIf="hasError('eventInfo.meetingUrl', 'required')">URL is required.</small>
      <small class="error" *ngIf="hasError('eventInfo.meetingUrl', 'pattern')">Include http(s)://</small>
    </div>

    <div class="panel" formGroupName="organizer">
      <h2>Organizer</h2>
      <label>
        <span class="label-heading">
          Full name <span class="required-indicator" aria-hidden="true">*</span>
        </span>
        <input type="text" formControlName="fullName" />
      </label>
      <small class="error" *ngIf="hasError('organizer.fullName', 'required')">Name is mandatory.</small>

      <label>
        <span class="label-heading">
          Email <span class="required-indicator" aria-hidden="true">*</span>
        </span>
        <input type="email" formControlName="email" />
      </label>
      <small class="error" *ngIf="hasError('organizer.email', 'required')">Email is required.</small>
      <small class="error" *ngIf="hasError('organizer.email', 'email')">Provide a valid email.</small>

      <ng-container *ngIf="contactPreference() === 'phone'">
        <label>
          <span class="label-heading">
            Phone <span class="required-indicator" aria-hidden="true">*</span>
          </span>
          <small class="required-note">Required when contact preference is Phone.</small>
          <input type="tel" formControlName="phone" />
        </label>
        <small class="error" *ngIf="hasError('organizer.phone', 'required')">Phone required for calls.</small>
        <small class="error" *ngIf="hasError('organizer.phone', 'pattern')">Use country code and digits.</small>
      </ng-container>

      <label>
        <span class="label-heading">
          Preferred contact channel <span class="required-indicator" aria-hidden="true">*</span>
        </span>
        <select formControlName="contactPreference">
          <option value="email">Email</option>
          <option value="phone">Phone</option>
        </select>
      </label>
    </div>
  </div>

  <div class="panel" formArrayName="tickets">
    <header class="panel__header">
      <div>
        <h2>Ticket tiers</h2>
        <p>Dynamic FormArray with inline validation & derived calculations.</p>
      </div>
      <button type="button" class="btn" (click)="addTicket()">Add tier</button>
    </header>

    <div class="tickets" *ngFor="let ticketGroup of tickets.controls; let i = index; trackBy: trackTicket" [formGroupName]="i">
      <div class="tickets__row">
        <label>
          <span class="label-heading">
            Label <span class="required-indicator" aria-hidden="true">*</span>
          </span>
          <input type="text" formControlName="label" />
        </label>
        <label>
          <span class="label-heading">
            Capacity <span class="required-indicator" aria-hidden="true">*</span>
          </span>
          <input type="number" formControlName="capacity" min="1" />
        </label>
        <label>
          <span class="label-heading">
            Price ($) <span class="required-indicator" aria-hidden="true">*</span>
          </span>
          <input type="number" formControlName="price" min="0" step="1" />
        </label>
        <label>
          <span class="label-heading">
            Available from <span class="required-indicator" aria-hidden="true">*</span>
          </span>
          <input type="date" formControlName="availableFrom" />
        </label>
        <label>
          <span class="label-heading">
            Until <span class="required-indicator" aria-hidden="true">*</span>
          </span>
          <input type="date" formControlName="availableTo" />
        </label>
        <button type="button" class="btn btn--ghost" (click)="removeTicket(i)" [disabled]="tickets.length === 1">
          Remove
        </button>
      </div>
      <small class="error" *ngIf="ticketGroup.hasError('dateOrder')">Until must be after start.</small>
    </div>
  </div>

  <div class="panel panel--summary">
    <h2>Realtime summary</h2>
    <div class="summary">
      <div>
        <p class="eyebrow">Capacity</p>
        <h3>{{ summary().totalCapacity }}</h3>
      </div>
      <div>
        <p class="eyebrow">Potential revenue</p>
        <h3>${{ summary().potentialRevenue | number: '1.0-0' }}</h3>
      </div>
    </div>
    <label class="consent">
      <input type="checkbox" formControlName="agreement" />
      <span>
        I confirm all details are correct.
        <span class="required-indicator" aria-hidden="true">*</span>
      </span>
    </label>
    <small class="error" *ngIf="hasError('agreement', 'required')">Consent is required.</small>
  </div>

  <div class="panel panel--preview">
    <h2>Live payload preview</h2>
    <pre>{{ eventPlannerForm.getRawValue() | json }}</pre>
  </div>

  <div class="panel panel--preview" *ngIf="submittedPayload">
    <h2>Last submitted payload</h2>
    <pre>{{ submittedPayload | json }}</pre>
  </div>

   <div class="actions">
      <button class="btn" type="submit">Submit form</button>
    </div>
  </form>
