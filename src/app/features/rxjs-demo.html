<div class="container mx-auto p-6">
  <h1 class="text-3xl font-bold mb-6">RxJS Advanced Concepts Demo</h1>
  
  <!-- Subjects -->
  <section class="mb-8 p-6 bg-white rounded-lg shadow-md">
    <h2 class="text-2xl font-semibold mb-4">1. Subjects & BehaviorSubjects</h2>
    
    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
      <div class="p-4 border rounded">
        <h3 class="text-xl font-medium mb-3">Subject</h3>
        <p class="mb-3">Current value: {{ subjectMessage || 'No value yet' }}</p>
        <input 
          #subjectInput
          type="text" 
          class="border p-2 rounded w-full mb-2" 
          placeholder="Enter a message"
        >
        <button 
          (click)="emitSubjectValue(subjectInput.value); subjectInput.value = ''" 
          class="bg-green-500 hover:bg-green-600 text-white px-4 py-2 rounded"
        >
          Emit Subject Value
        </button>
      </div>
      
      <div class="p-4 border rounded">
        <h3 class="text-xl font-medium mb-3">BehaviorSubject</h3>
        <p class="mb-3">Current value: {{ behaviorSubjectMessage }}</p>
        <input 
          #behaviorSubjectInput
          type="text" 
          class="border p-2 rounded w-full mb-2"
          placeholder="Enter a message"
        >
        <button 
          (click)="emitBehaviorSubjectValue(behaviorSubjectInput.value); behaviorSubjectInput.value = ''" 
          class="bg-indigo-500 hover:bg-indigo-600 text-white px-4 py-2 rounded"
        >
          Emit BehaviorSubject Value
        </button>
      </div>
    </div>
  </section>

  <!-- SwitchMap, MergeMap, ConcatMap Comparison -->
  <section class="mb-8 p-6 bg-white rounded-lg shadow-md">
    <h2 class="text-2xl font-semibold mb-4">2. switchMap vs mergeMap vs concatMap</h2>
    
    <div class="mb-4">
      <p class="mb-3">Type in the search boxes below to see the difference between operators:</p>
      
      <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-6">
        <!-- switchMap -->
        <div class="p-4 border rounded">
          <h3 class="text-lg font-medium mb-2">switchMap</h3>
          <p class="text-sm text-gray-600 mb-3">Cancels previous requests</p>
          <input 
            type="text" 
            (input)="onSearchChange($event, 'switchMap')"
            class="border p-2 rounded w-full mb-2" 
            placeholder="Search with switchMap..."
          >
          <div *ngIf="isLoading.switchMap" class="text-sm text-blue-600">
            <span class="loading"></span> Searching...
          </div>
          <div *ngIf="switchMapResults.length > 0" class="mt-3">
            <h4 class="font-medium mb-2">Results ({{ switchMapResults.length }})</h4>
            <div class="space-y-2">
              <div *ngFor="let movie of switchMapResults" class="p-2 border rounded text-sm">
                <div class="font-medium">{{ movie.title }}</div>
                <div class="text-xs text-gray-500">{{ movie.release_date | date:'yyyy' }} • ★ {{ movie.vote_average }}</div>
              </div>
            </div>
          </div>
        </div>
        
        <!-- mergeMap -->
        <div class="p-4 border rounded">
          <h3 class="text-lg font-medium mb-2">mergeMap</h3>
          <p class="text-sm text-gray-600 mb-3">Processes all requests in parallel</p>
          <input 
            type="text" 
            (input)="onSearchChange($event, 'mergeMap')"
            class="border p-2 rounded w-full mb-2" 
            placeholder="Search with mergeMap..."
          >
          <div *ngIf="isLoading.mergeMap" class="text-sm text-blue-600">
            <span class="loading"></span> Searching...
          </div>
          <div *ngIf="mergeMapResults.length > 0" class="mt-3">
            <h4 class="font-medium mb-2">Results ({{ mergeMapResults.length }})</h4>
            <div class="space-y-2">
              <div *ngFor="let movie of mergeMapResults" class="p-2 border rounded text-sm">
                <div class="font-medium">{{ movie.title }}</div>
                <div class="text-xs text-gray-500">{{ movie.release_date | date:'yyyy' }} • ★ {{ movie.vote_average }}</div>
              </div>
            </div>
          </div>
        </div>
        
        <!-- concatMap -->
        <div class="p-4 border rounded">
          <h3 class="text-lg font-medium mb-2">concatMap</h3>
          <p class="text-sm text-gray-600 mb-3">Processes requests sequentially</p>
          <input 
            type="text" 
            (input)="onSearchChange($event, 'concatMap')"
            class="border p-2 rounded w-full mb-2" 
            placeholder="Search with concatMap..."
          >
          <div *ngIf="isLoading.concatMap" class="text-sm text-blue-600">
            <span class="loading"></span> Searching...
          </div>
          <div *ngIf="concatMapResults.length > 0" class="mt-3">
            <h4 class="font-medium mb-2">Results ({{ concatMapResults.length }})</h4>
            <div class="space-y-2">
              <div *ngFor="let movie of concatMapResults" class="p-2 border rounded text-sm">
                <div class="font-medium">{{ movie.title }}</div>
                <div class="text-xs text-gray-500">{{ movie.release_date | date:'yyyy' }} • ★ {{ movie.vote_average }}</div>
              </div>
            </div>
          </div>
        </div>
      </div>
      
      <!-- Search History -->
      <div *ngIf="searchHistory.length > 0" class="mt-6 p-4 border rounded bg-gray-50">
        <h3 class="font-medium mb-2">Search History</h3>
        <div class="text-sm space-y-1 max-h-40 overflow-y-auto">
          <div *ngFor="let item of searchHistory" class="flex justify-between items-center py-1 border-b">
            <div>
              <span class="font-mono px-2 py-0.5 rounded text-xs" 
                    [ngClass]="{
                      'bg-blue-100 text-blue-800': item.operator === 'switchMap',
                      'bg-green-100 text-green-800': item.operator === 'mergeMap',
                      'bg-purple-100 text-purple-800': item.operator === 'concatMap'
                    }">
                {{ item.operator }}
              </span>
              <span class="ml-2">{{ item.query || '(empty)' }}</span>
            </div>
            <span class="text-xs text-gray-500">{{ item.timestamp | date:'HH:mm:ss' }}</span>
          </div>
        </div>
      </div>
      
      <!-- Error Message -->
      <div *ngIf="apiError" class="mt-4 p-3 bg-red-100 text-red-700 rounded">
        {{ apiError }}
      </div>
      
      <!-- Explanation -->
      <div class="mt-6 p-4 bg-blue-50 rounded">
        <h3 class="font-medium text-blue-800 mb-2">How to test:</h3>
        <ol class="list-decimal pl-5 space-y-1 text-sm text-blue-700">
          <li>Type quickly in the search boxes to see the difference in behavior</li>
          <li>switchMap: Cancels previous requests, only shows latest results</li>
          <li>mergeMap: Processes all requests in parallel, results may be out of order</li>
          <li>concatMap: Processes requests one after another, maintains order</li>
        </ol>
      </div>
    </div>
  </section>

  <!-- Unsubscribing Strategies -->
  <section class="mb-8 p-6 bg-white rounded-lg shadow-md">
    <h2 class="text-2xl font-semibold mb-4">3. Unsubscribing Strategies</h2>
    
    <div class="mb-4">
      <p class="mb-3">Select an unsubscribing method:</p>
      <div class="flex flex-wrap gap-4 mb-4">
        <button 
          (click)="startUnsubscribeExample('unsubscribe')" 
          [class.bg-red-600]="unsubscribeMethod === 'unsubscribe'"
          class="bg-red-500 hover:bg-red-600 text-white px-4 py-2 rounded"
        >
          Using unsubscribe()
        </button>
        <button 
          (click)="startUnsubscribeExample('takeUntil')" 
          [class.bg-red-600]="unsubscribeMethod === 'takeUntil'"
          class="bg-red-500 hover:bg-red-600 text-white px-4 py-2 rounded"
        >
          Using takeUntil
        </button>
        <button 
          (click)="startUnsubscribeExample('takeWhile')" 
          [class.bg-red-600]="unsubscribeMethod === 'takeWhile'"
          class="bg-red-500 hover:bg-red-600 text-white px-4 py-2 rounded"
        >
          Using takeWhile
        </button>
      </div>
      
      <div *ngIf="unsubscribeResults.length > 0" class="mt-4 p-4 bg-gray-100 rounded">
        <h3 class="font-medium mb-2">Console Output:</h3>
        <div class="font-mono text-sm space-y-1">
          <div *ngFor="let log of unsubscribeResults" class="border-b border-gray-200 py-1">
            {{ log }}
          </div>
        </div>
      </div>
    </div>
  </section>
</div>
